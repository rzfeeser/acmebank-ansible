---
- name: Making an RESTful API request to NASA
  hosts: localhost
  connection: local

  vars_files:
      - ~/secrets.yml # has our API key --> apikey

  tasks:
      - name: create a failure
        command: /bin/false

      - name: Lookup our NASA APOD API
        uri:
            method: GET
            url: "https://api.nasa.gov/planetary/apod?api_key={{ apikey }}"
        register: results

      - name: Check out the results
        debug:
            verbosity: 1 # 1 to 5  -- how many "-v" flags do we need to see this?
            var: results.json.hdurl

      - name: Download file
        get_url:
          url: "{{ results.json.hdurl }}"
          dest: ~/static/2022-05-17-nasa_hdurl.jpg
